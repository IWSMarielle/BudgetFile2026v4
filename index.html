<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gyrus Group - Corporate Multi-Ledger</title>
    <style>
        /* LOGIN & MANAGEMENT OVERLAY */
        #password-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0f172a; display: flex; justify-content: center;
            align-items: center; z-index: 9999; color: white; flex-direction: column;
        }
        .login-box { 
            background: #1e293b; padding: 40px; border-radius: 12px; 
            border: 2px solid #fbbf24; text-align: center; width: 400px;
        }
        .login-box select, .login-box input { 
            padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #475569; 
            width: 100%; text-align: center; font-size: 14px; background: #0f172a; color: white;
        }
        .btn-prime { background: #fbbf24; color: #0f172a; border: none; padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-sub { background: transparent; color: #94a3b8; border: 1px solid #475569; padding: 8px; border-radius: 6px; font-size: 11px; cursor: pointer; margin-top: 20px; width: 100%; }
        
        /* HIDDEN ADMIN PANEL */
        #admin-panel { display: none; margin-top: 20px; padding-top: 20px; border-top: 1px dashed #475569; width: 100%; }

        /* TABLE STYLES */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .header-main { background: #0f172a; color: #fbbf24; padding: 15px; text-align: center; border-bottom: 4px solid #fbbf24; }
        .toolbar { display: flex; gap: 10px; background: #fff; padding: 10px; border-bottom: 1px solid #cbd5e1; }
        .table-container { overflow-x: auto; background: white; height: calc(100vh - 120px); }
        table { border-collapse: collapse; min-width: 5000px; }
        .sticky-col { position: sticky; left: 0; background: #1e293b !important; color: white; z-index: 10; width: 350px; padding: 5px; }
        td, th { border: 1px solid #e2e8f0; padding: 5px; text-align: right; font-size: 12px; }
        .category-header { background: #334155; color: #fbbf24; font-weight: bold; text-align: left; }
    </style>
</head>
<body>

    <div id="password-overlay">
        <div class="login-box">
            <h1 style="color:#fbbf24; margin-bottom:10px;">CORPORATE PORTAL</h1>
            
            <div id="login-view">
                <select id="companySelect"></select>
                <input type="password" id="passInput" placeholder="Access Code">
                <button class="btn-prime" onclick="checkAccess()">UNLOCK LEDGER</button>
                <button class="btn-sub" onclick="toggleAdmin()">+ MANAGE COMPANIES</button>
                <p id="err" style="color:#f87171; font-size:12px; margin-top:10px;"></p>
            </div>

            <div id="admin-panel">
                <p style="font-size:12px; color:#fbbf24; margin-bottom:10px;">ADD NEW ENTITY</p>
                <input type="text" id="newCoName" placeholder="New Company Name">
                <input type="text" id="newCoPass" placeholder="Set Access Code">
                <button class="btn-prime" style="background:#10b981; color:white;" onclick="addNewCompany()">SAVE NEW ENTITY</button>
                <button class="btn-sub" onclick="toggleAdmin()">CANCEL</button>
            </div>
        </div>
    </div>

    <div id="main-content" style="display:none;">
        <div class="header-main"><h1 id="activeCoTitle">COMPANY NAME</h1></div>
        <div class="toolbar">
            <button onclick="location.reload()" style="background:#ef4444; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">ðŸ”’ LOGOUT</button>
            <button onclick="addRow('sales')" style="background:#10b981; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">+ ADD REVENUE ROW</button>
        </div>
        <div class="table-container">
            <table id="mainTable">
                <thead><tr id="mHead"></tr></thead>
                <tbody id="sales-rows">
                    <tr class="category-header"><td class="sticky-col">REVENUE STREAMS</td><td colspan="100"></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // 1. INITIAL SETUP & PRE-LOADED DATA
        let companies = JSON.parse(localStorage.getItem('corp_registry')) || [
            { name: "GYRUS INDUSTRIES CORPORATION", pass: "GYRUS2026", id: "gyrus_data" },
            { name: "IWS-TECHSERV CORPORATION", pass: "IWS2026", id: "iws_data" }
        ];

        let activeDB = "";

        function updateDropdown() {
            const select = document.getElementById('companySelect');
            select.innerHTML = companies.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        }

        // 2. COMPANY MANAGEMENT
        function toggleAdmin() {
            const panel = document.getElementById('admin-panel');
            const login = document.getElementById('login-view');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            login.style.display = login.style.display === 'none' ? 'block' : 'none';
        }

        function addNewCompany() {
            const name = document.getElementById('newCoName').value;
            const pass = document.getElementById('newCoPass').value;
            if(!name || !pass) return alert("Please fill all fields");

            const newCo = {
                name: name.toUpperCase(),
                pass: pass,
                id: "db_" + name.toLowerCase().replace(/\s+/g, '_') + "_" + Date.now()
            };

            companies.push(newCo);
            localStorage.setItem('corp_registry', JSON.stringify(companies));
            updateDropdown();
            toggleAdmin();
            alert("New company added successfully!");
        }

        // 3. ACCESS CONTROL
        function checkAccess() {
            const id = document.getElementById('companySelect').value;
            const pass = document.getElementById('passInput').value;
            const targetCo = companies.find(c => c.id === id);

            if (targetCo && targetCo.pass === pass) {
                activeDB = targetCo.id;
                document.getElementById('password-overlay').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                document.getElementById('activeCoTitle').innerText = targetCo.name;
                buildTable();
            } else {
                document.getElementById('err').innerText = "INVALID ACCESS CODE";
            }
        }

        // 4. TABLE LOGIC
        function buildTable() {
            const head = document.getElementById('mHead');
            head.innerHTML = '<th class="sticky-col">ACCOUNT</th>';
            for(let i=1; i<=12; i++) head.innerHTML += `<th colspan="3">MONTH ${i}</th>`;
            
            // Load existing data for this specific company
            const saved = JSON.parse(localStorage.getItem(activeDB)) || [];
            saved.forEach(row => renderRow('sales', row));
        }

        function addRow(section) {
            renderRow(section, { name: "", vals: [] });
            saveAll();
        }

        function renderRow(section, data) {
            const tbody = document.getElementById(section + '-rows');
            const tr = document.createElement('tr');
            let html = `<td class="sticky-col"><input type="text" value="${data.name}" oninput="saveAll()" style="width:100%; background:transparent; color:white; border:none;"></td>`;
            for(let i=0; i<36; i++) {
                html += `<td><input type="text" oninput="saveAll()" style="width:50px; border:none; text-align:right;"></td>`;
            }
            tr.innerHTML = html;
            tbody.appendChild(tr);
        }

        function saveAll() {
            const rows = [];
            document.querySelectorAll('#sales-rows tr:not(.category-header)').forEach(tr => {
                const name = tr.querySelector('input').value;
                rows.push({ name: name });
            });
            localStorage.setItem(activeDB, JSON.stringify(rows));
        }

        // Initial Load
        updateDropdown();
    </script>
</body>
</html>
